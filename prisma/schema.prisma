// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Discoveries {
  id        Int       @default(autoincrement()) @id
  email     String
  typeform_id   String
  BMR Int
  carbs_macronutrients    Int
  protein_macronutrients  Int
  fat_macronutrients Int
  carbs_per_meal Int
  protein_per_meal Int
  fat_per_meal Int
  calorie_per_meal Int
}

model Customers{
  id                      Int             @default(autoincrement()) @id
  email                   String  @unique
  intermediateCustomerNutritionNeeds IntermediateCustomerNutritionNeed[]
  intermediateCustomerMedicalConditions IntermediateCustomerMedicalCondition[]
  intermediateCustomerAllergens IntermediateCustomerAllergen[]
  surveyQuestionAnswerServiceFeedback SurveyQuestionAnswerServiceFeedback[]
  surveyQuestionAnswerProductFeedback SurveyQuestionAnswerProductFeedback[]
  customerProductDistance CustomerProductDistance[]
  customerBoxItems CustomerBoxItems[]
  queuedShopifyOrder QueuedShopifyOrder[]
  intermediateCustomerFlavorDislike IntermediateCustomerFlavorDislike[]
  intermediateCustomerDislikeCategory IntermediateCustomerCategoryRank[]
  intermediateCustomerIngredientDislike IntermediateCustomerIngredientDislike[]
  intermediateCustomerProductFoodType IntermediateCustomerProductFoodType[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model IntermediateCustomerNutritionNeed{
  customerNutritionNeed    CustomerNutritionNeed   @relation(fields: [customerNutritionNeedId], references: [id])
  customerNutritionNeedId Int
  customer                   Customers                @relation(fields: [customerId], references: [id])
  customerId                Int
  nutritionValue            Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([customerNutritionNeedId, customerId])
}

model CustomerNutritionNeed{
  id            Int       @default(autoincrement()) @id
  description   String?
  label         String @unique
  intermediateCustomerNutritionNeed      IntermediateCustomerNutritionNeed[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}


model IntermediateCustomerMedicalCondition{
  medicalConditionValue String
  customerMedicalCondition CustomerMedicalCondition @relation(fields: [customerMedicalConditionId], references: [id])
  customerMedicalConditionId Int
  customer                   Customers                @relation(fields: [customerId], references: [id])
  customerId                Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([customerMedicalConditionId, customerId])
}


model CustomerMedicalCondition{
  id    Int     @default(autoincrement()) @id
  description   String?
  label String  @unique
  intermediateCustomerMedicalConditions IntermediateCustomerMedicalCondition[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model IntermediateCustomerProductFoodType{
  customerProductFoodType    CustomerProductFoodType   @relation(fields: [customerProductFoodTypeId], references: [id])
  customerProductFoodTypeId Int
  customer                   Customers                @relation(fields: [customerId], references: [id])
  customerId                Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([customerProductFoodTypeId, customerId])
}

model CustomerProductFoodType{
  id            Int       @default(autoincrement()) @id
  label         String @unique
  intermediateCustomerProductFoodType IntermediateCustomerProductFoodType[]
  intermediateProductFoodType IntermediateProductFoodType[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model IntermediateProductFoodType{
  customerProductFoodType    CustomerProductFoodType   @relation(fields: [customerProductFoodTypeId], references: [id])
  customerProductFoodTypeId Int
  product                   Product                @relation(fields: [productId], references: [id])
  productId                Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([customerProductFoodTypeId, productId])
}

model Product{
  id                  Int             @default(autoincrement()) @id
  productPovider     ProductPovider @relation(fields: [productPoviderId], references: [id])
  productPoviderId  Int
  intermediateProductFoodType IntermediateProductFoodType[]
  intermediateProductCategories IntermediateProductCategory[]
  productFlavor ProductFlavor? @relation(fields: [productFlavorId], references: [id])
  productFlavorId Int?
  intermediateProductIngredients IntermediateProductIngredient[]	
  intermediateProductAllergens IntermediateProductAllergen[]
  externalSku   String @unique
  upcCode  String?
  productNutritionFact ProductNutritionFact?
  surveyQuestionAnswerProductFeedback SurveyQuestionAnswerProductFeedback[]
  customerProductDistance CustomerProductDistance[]
  customerBoxItems CustomerBoxItems[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())
}


model ProductFlavor{
  id       Int         @default(autoincrement()) @id
  label String @unique
  products   Product[]
  intermediateCustomerFlavorDislike IntermediateCustomerFlavorDislike[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())
}


model IntermediateProductCategory{
  product Product @relation(fields: [productId], references: [id])
  productId Int
  productCategory   ProductCategory   @relation(fields: [productCategoryId], references: [id])
  productCategoryId  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([productId, productCategoryId])
}

model IntermediateCustomerFlavorDislike{
  productFlavor ProductFlavor @relation(fields: [productFlavorId], references: [id])
  productFlavorId Int
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([productFlavorId, customerId])
}


model ProductCategory{
  id       Int         @default(autoincrement()) @id
  label String @unique
  intermediateProductCategories IntermediateProductCategory[]
  intermediateCustomerDislikeCategory IntermediateCustomerCategoryRank[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())
}


model IntermediateCustomerCategoryRank{
  productCategory ProductCategory @relation(fields: [productCategoryId], references: [id])
  productCategoryId Int
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  rank Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([productCategoryId, customerId])
}


model IntermediateProductIngredient{
  product Product @relation(fields: [productId], references: [id])
  productId Int
  productIngredient   ProductIngredient   @relation(fields: [productIngredientId], references: [id])
  productIngredientId  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([productId, productIngredientId])
}

model ProductIngredient{
  id       Int         @default(autoincrement()) @id
  label String @unique
  intermediateProductIngredients IntermediateProductIngredient[]
  intermediateCustomerIngredientDislike IntermediateCustomerIngredientDislike[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model IntermediateCustomerIngredientDislike{
  productIngredient ProductIngredient @relation(fields: [productIngredientId], references: [id])
  productIngredientId Int
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([productIngredientId, customerId])
}

model IntermediateProductAllergen{
  product Product @relation(fields: [productId], references: [id])
  productId Int
  productAllergen   ProductAllergen   @relation(fields: [productAllergenId], references: [id])
  productAllergenId  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([productId, productAllergenId])
}

model ProductAllergen{
  id       Int         @default(autoincrement()) @id
  label String @unique
  intermediateProductAllergens IntermediateProductAllergen[]
  intermediateCustomerAllergens IntermediateCustomerAllergen[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model IntermediateCustomerAllergen{
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  productAllergen   ProductAllergen   @relation(fields: [productAllergenId], references: [id])
  productAllergenId  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([customerId, productAllergenId])
}


model ProductNutritionFact{
  id                  Int             @default(autoincrement()) @id
  product   Product @relation(fields: [productId], references: [id])
  productId Int
  quantity	Int? 
  servingSize	Int? 
  calories Int?
  totalFatG Float?
  saturatedFatG Float?
  transFatG	Float? 
  cholesteroleMg	Float?
  sodiumMg	Float?
  totalCarbohydrateG	Float?
  dietaryFiberG	Float?
  totalSugarG	Float?
  addedSugarG	Float?
  proteinG	Float?
  sweet	Float?
  sour	Float?
  salty	Float?
  bitter	Float?
  spicy	Float?
  texture Texure	@default(medium)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())
}

enum Texure {
  soft
  medium
  hard
}

model ProductPovider{
  id       Int         @default(autoincrement()) @id
  provider String  @unique
  products  Product[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())
}

model Survey{
  id                              Int       @default(autoincrement()) @id
  name String @unique
  intermediateSurveyQuestion IntermediateSurveyQuestion[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())
}

model IntermediateSurveyQuestion{
  survey Survey @relation(fields: [surveyId], references: [id])
  surveyId Int
  order Int?
  surveyQuestion SurveyQuestion @relation(fields: [surveyQuestionId], references: [id])
  surveyQuestionId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([surveyId, surveyQuestionId])
}

model SurveyQuestion{
  id  Int   @default(autoincrement()) @id
  name String @unique
  label String 
  questionCategory QuestionCategory @relation(fields: [questionCategoryId], references: [id])
  questionCategoryId Int
  mustBeAnswered Boolean
  instruction String?
  placeholder String?
  surveyQuestionAnswerType SurveyQuestionAnswerType @relation(fields: [surveyQuestionAnswerTypeId], references: [id])
  surveyQuestionAnswerTypeId Int
  intermediateSurveyQuestion IntermediateSurveyQuestion[]
  surveyQuestionOptions SurveyQuestionOption[]
  surveyQuestionAnswerServiceFeedback SurveyQuestionAnswerServiceFeedback[]
  surveyQuestionAnswerProductFeedback SurveyQuestionAnswerProductFeedback[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model QuestionCategory {
  id  Int   @default(autoincrement()) @id
  label String @unique
  surveyQuestions SurveyQuestion[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model SurveyQuestionAnswerType{
  id  Int   @default(autoincrement()) @id
  label String @unique
  surveyQuestions SurveyQuestion[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model SurveyQuestionOption{
  id  Int   @default(autoincrement()) @id
  label String 
  surveyQuestion SurveyQuestion @relation(fields: [surveyQuestionId], references: [id])
  surveyQuestionId Int
  surveyQuestionAnswerServiceFeedback SurveyQuestionAnswerServiceFeedback[]
  surveyQuestionAnswerProductFeedback SurveyQuestionAnswerProductFeedback[]
  intermediateSurveyQuestionAnswerService IntermediateSurveyQuestionAnswerService[]
  intermediateSurveyQuestionAnswerProduct IntermediateSurveyQuestionAnswerProduct[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

   @@unique([label, surveyQuestionId], name: "QuestionOptionIdentifier")
}

model SurveyQuestionAnswerServiceFeedback{
  id  Int   @default(autoincrement()) @id
  intermediateSurveyQuestionAnswerService IntermediateSurveyQuestionAnswerService[]
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  surveyQuestion SurveyQuestion @relation(fields: [surveyQuestionId], references: [id])
  surveyQuestionId Int
  answerOption SurveyQuestionOption? @relation(fields: [answerSingleOptionId], references: [id])
  answerSingleOptionId Int?
  answerNumeric Int?
  answerText String?
  answerBool Boolean?
  reason String?
  title String?
  content String?
  answerCount Int?
  shopifyOrderNumber String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@unique([surveyQuestionId,shopifyOrderNumber], name: "CustomerSurveyQuestionServiceFeedbackIdentifier")
}

model IntermediateSurveyQuestionAnswerService{
  surveyQuestionAnswerServiceFeedback SurveyQuestionAnswerServiceFeedback @relation(fields: [surveyQuestionAnswerServiceFeedbackId], references: [id])
  surveyQuestionAnswerServiceFeedbackId Int
  surveyQuestionOption SurveyQuestionOption @relation(fields: [surveyQuestionOptionId], references: [id])
  surveyQuestionOptionId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([surveyQuestionAnswerServiceFeedbackId, surveyQuestionOptionId])
}

model SurveyQuestionAnswerProductFeedback{
  id  Int   @default(autoincrement()) @id
  intermediateSurveyQuestionAnswerProduct IntermediateSurveyQuestionAnswerProduct[]
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  surveyQuestion SurveyQuestion @relation(fields: [surveyQuestionId], references: [id])
  surveyQuestionId Int
  answerOption SurveyQuestionOption? @relation(fields: [answerSingleOptionId], references: [id])
  answerSingleOptionId Int?
  answerNumeric Int?
  answerText String?
  answerBool Boolean?
  reason String?
  title String?
  content String?
  answerCount Int?
  product Product @relation(fields: [productId], references: [id])
  productId Int
  shopifyOrderNumber String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@unique([surveyQuestionId,shopifyOrderNumber, productId], name: "CustomerSurveyQuestionProductFeedbackIdentifier")

}

model IntermediateSurveyQuestionAnswerProduct{
  surveyQuestionAnswerProductFeedback SurveyQuestionAnswerProductFeedback @relation(fields: [surveyQuestionAnswerProductFeedbackId], references: [id])
  surveyQuestionAnswerProductFeedbackId Int
  surveyQuestionOption SurveyQuestionOption @relation(fields: [surveyQuestionOptionId], references: [id])
  surveyQuestionOptionId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())

  @@id([surveyQuestionAnswerProductFeedbackId, surveyQuestionOptionId])
}

model CustomerProductDistance{
  id  Int   @default(autoincrement()) @id
  distance Float
  product Product @relation(fields: [productId], references: [id])
  productId Int
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  version   DateTime  @default(now())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}

model CustomerBoxItems{
  id  Int   @default(autoincrement()) @id
  product Product @relation(fields: [productId], references: [id])
  productId Int
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt @default(now())
}


model QueuedShopifyOrder {
  id  Int   @default(autoincrement()) @id
  orderName String @unique
  customer Customers @relation(fields: [customerId], references: [id])
  customerId Int
  scheduledAt String
  status QueueStatus @default(queue)
  completedAt String?
}

enum QueueStatus {
  queue
  complete
}
